#!/usr/bin/env coffee

util	= require "util"
fs	= require "fs"
couchdb	= require "then-couchdb"

fs.exists "config.json", ( config_exists ) ->

	# Helper config fail function.
	config_fail = ( msg ) ->
		_msg	= "Unable to load configuration file."
		if msg
			util.log _msg + " ( " + msg + " )"
		else
			util.log _msg

		process.exit 1

	if not config_exists
		return config_fail( )

	fs.readFile "config.json", ( err, data ) ->
		if err
			return config_fail err
		try
			configuration	= JSON.parse( data )

			if not configuration["db_uri"]?
				return config_fail "No database URI specified in configuration file."
		catch err
			return config_fail( err )

		# Make the database connection.
		db	= couchdb.createClient configuration["db_uri"]

		util.log util.inspect db
